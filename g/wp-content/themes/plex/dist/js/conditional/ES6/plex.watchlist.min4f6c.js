"use strict";!function(t,e){var a=Plex.getAuthToken()||!1;Plex.debugLog()&&PlexUtils.getParam("token")&&(a=PlexUtils.getParam("token"));for(var n={},i={data:function(){return{updating:!1,showingResult:!1,ratingKey:"",metadata:{valid:!1,endpoint:n.endpoint.metadata},watchlist:{endpoint:n.endpoint.actions,action:"addToWatchlist",updated:!1,error:!1}}},methods:{setProps:function(t){this.ratingKey=t.ratingKey},getWatchlistState:function(){var t=this;if(a){var e={headers:{"X-Plex-Token":a,Accept:"application/json"}};fetch(this.metadata.endpoint+"/"+encodeURIComponent(this.ratingKey),e).then(function(t){if(!t.ok)throw new Error("HTTP error! status: ${response.status}");return t.text()}).then(function(t){var e=JSON.parse(t);if(void 0===e.MediaContainer.Metadata[0])throw new Error("Metadata is not valid");return e.MediaContainer.Metadata[0]}).then(function(e){t.metadata.valid=!0,e.watchlistedAt?t.watchlist.action="removeFromWatchlist":t.watchlist.action="addToWatchlist"}).catch(function(){t.metadata.valid=!1})}},updateWatchlist:function(){var t=this;if(a){var e={headers:{},method:"PUT"};e.headers["X-Plex-Token"]=a,this.updating=!0,fetch(this.watchlist.endpoint+"/"+this.watchlist.action+"/?ratingKey="+encodeURIComponent(this.ratingKey),e).then(function(e){if(t.updating=!1,t.metadata.valid=!1,!e.ok)throw new Error("HTTP error! status: ${response.status}");return e.text()}).then(function(t){return(new DOMParser).parseFromString(t,"text/xml")}).then(function(e){t.watchlist.action="addToWatchlist"===t.watchlist.action?"removeFromWatchlist":"addToWatchlist",t.watchlist.updated=!0}).catch(function(){t.watchlist.error=!0})}},hideFast:function(){var t=this;setTimeout(function(){t.watchlist.updated=!1,t.watchlist.error=!1},500),setTimeout(function(){t.metadata.valid=!0},1e3)}},mounted:function(){this.getWatchlistState()}},o=document.getElementsByClassName("plex-watchlist-link"),r=0;r<o.length;r++)i.el="#"+o[r].id,n=plex_watchlist_l10n[o[r].id],new Vue(i)}(window);